<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœå¯¦åˆ†é…</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header>
        <h1 id="mainTitle">æœå¯¦åˆ†é…</h1>
        
        <div id="cloudStatus" class="cloud-status" style="display: none;">
            <span class="status-dot"></span>
            <span id="cloudStatusText">é€£ç·šä¸­...</span>
        </div>

        <div class="header-controls">
            <select id="saveSlotSelect" class="save-slot-select">
                <option value="default">ğŸ“ å­˜æª” 1 (é è¨­)</option>
                <option value="slot2">ğŸ“ å­˜æª” 2</option>
                <option value="slot3">ğŸ“ å­˜æª” 3</option>
                <option value="slot4">ğŸ“ å­˜æª” 4</option>
                <option value="slot5">ğŸ“ å­˜æª” 5</option>
            </select>

            <input type="text" id="recordName" placeholder="è¼¸å…¥ç´€éŒ„åç¨±">
            <button id="saveData" class="btn btn-green">ğŸ’¾ ä¸‹è¼‰å‚™ä»½</button>
            <input type="file" id="loadFile" style="display:none;" accept=".json">
            <button id="loadData" class="btn btn-blue">ğŸ“‚ è¼‰å…¥å‚™ä»½</button>
            <button id="resetAllData" class="btn btn-red">ğŸ”¥ å…¨éƒ¨åˆå§‹åŒ–</button>
        </div>
    </header>

    <section class="section-card">
        <h2>è§’è‰²ç®¡ç† (ä¸»åŠ›éœ€æ±‚æ–¹)</h2>
        <div class="control-row">
            <input type="text" id="newCharacter" placeholder="è¼¸å…¥ä¸»åŠ›è§’è‰²åç¨±" class="input-wide">
            <button id="addCharacter" class="btn btn-green">â• æ–°å¢è§’è‰²</button>
            <button id="showCharacterList" class="btn btn-blue">ğŸ“‹ è§’è‰²æ¸…å–® (<span id="characterCount">0</span>)</button>
            <button id="resetCharacterList" class="btn btn-red">ğŸ”„ é‡ç½®è§’è‰²æ¸…å–®</button>
        </div>
    </section>

    <section class="section-card">
        <h2>æœå¯¦åº«å­˜ç®¡ç†</h2>
        
        <div class="tabs-header">
            <button class="tab-btn active" data-tab="tab-overview">ğŸ“Š ç¸½è¦½</button>
            <button class="tab-btn" data-tab="tab-bank">ğŸ¦ è‹±é›„ BANK (é³¥ç± )</button>
            <button class="tab-btn" data-tab="tab-storage">ğŸ“¦ è§’è‰²æš«å­˜ç®± (<span id="storageCharCount">0</span> éš»)</button>
        </div>

        <div id="tab-overview" class="tab-content active">
             <div class="inventory-container">
                <div class="inventory-box box-green">
                    <div class="box-title title-green">âš”ï¸ åŠ æ“Šé¡ç¸½è¦½</div>
                    <div id="attackFruitsOverview" class="fruit-grid col-3"></div>
                </div>

                <div class="inventory-box box-blue">
                    <div class="box-title title-blue">ğŸ¯ å…¶ä»–é¡ç¸½è¦½</div>
                    <div id="otherFruitsOverview" class="fruit-grid col-2"></div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 15px; color: #666; font-size: 13px;">
                â€» ç¸½åº«å­˜ = è‹±é›„ BANK + è§’è‰²æš«å­˜ç®±ã€‚
            </div>
            <div class="add-fruit-row">
                <strong>æ–°å¢æœå¯¦é¡å‹ï¼š</strong>
                <input type="text" id="newFruitName" placeholder="æœå¯¦åç¨±">
                <select id="newFruitCategory">
                    <option value="åŠ æ“Šé¡">åŠ æ“Šé¡</option>
                    <option value="å…¶ä»–">å…¶ä»–</option>
                </select>
                <button id="addFruit" class="btn btn-green">â• æ–°å¢æœå¯¦</button>
                <button id="deleteFruitBtn" class="btn btn-red">ğŸ—‘ï¸ åˆªé™¤æœå¯¦</button>
            </div>
        </div>

        <div id="tab-bank" class="tab-content">
            <h3 style="text-align: center; margin-bottom: 15px;">é³¥ç± æ•¸é‡ï¼š7 å€‹</h3>
            <div class="bank-container">
                <div id="bankFruitSelectors" class="fruit-grid col-3">
                    </div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button id="resetBank" class="btn btn-red">ğŸ”„ é‡ç½®æ‰€æœ‰é³¥ç± </button>
            </div>
        </div>

        <div id="tab-storage" class="tab-content">
            <div class="control-row" style="margin-bottom: 20px;">
                <input type="text" id="newStorageChar" placeholder="è¼¸å…¥å€‰åº«è§’è‰²åç¨± (ä¾‹: 4æ˜Ÿè§’)" class="input-wide">
                <button id="addStorageChar" class="btn btn-green">â• æ–°å¢å€‰åº«è§’è‰²</button>
                <input type="text" id="searchStorageChar" placeholder="ğŸ” æœå°‹å€‰åº«..." style="margin-left: 10px;">
            </div>
            
            <div class="table-container">
                <table id="storageTable">
                    <thead>
                        <tr>
                            <th>å€‰åº«è§’è‰²</th>
                            <th>æŒæœ‰æœå¯¦ 1</th>
                            <th>æŒæœ‰æœå¯¦ 2</th>
                            <th>æŒæœ‰æœå¯¦ 3</th>
                            <th>æŒæœ‰æœå¯¦ 4</th>
                            <th style="width: 140px;">æ“ä½œ</th> </tr>
                    </thead>
                    <tbody id="storageTableBody"></tbody>
                </table>
            </div>
            <div style="text-align: center; margin-top: 15px; color: #666; font-size: 13px;">
                â€» é€™è£¡çš„è§’è‰²åƒ…ç”¨æ–¼ã€Œæš«å­˜æœå¯¦ã€ï¼Œå…¶æŒæœ‰çš„æœå¯¦æœƒè‡ªå‹•è¨ˆå…¥ç¸½åº«å­˜é‡ã€‚
            </div>
        </div>

    </section>

    <section class="section-card">
        <h2>æœå¯¦åˆ†é… (ä¸»åŠ›å€) (<span id="uncompletedCharCount">0</span> å¾…è¾¦)</h2>
        <div style="text-align: center; margin-bottom: 15px;">
             <button id="resetAssignments" class="btn btn-red">ğŸ”„ é‡ç½®è§’è‰²æœå¯¦</button>
        </div>

        <div class="search-row">
            <input type="text" id="searchCharacter" placeholder="ğŸ” æœå°‹è§’è‰²åç¨±æˆ–æœå¯¦..." class="input-wide">
            
            <select id="sortCharacterBy" class="sort-select">
                <option value="default">é è¨­æ’åº (æ·»åŠ æ™‚é–“)</option>
                <option value="unassigned_asc">æœªå®Œæˆåˆ†é…æ•¸é‡ (å°‘åˆ°å¤š)</option>
                <option value="unassigned_desc">æœªå®Œæˆåˆ†é…æ•¸é‡ (å¤šåˆ°å°‘)</option>
            </select>
            
            <div class="checkbox-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="filterModeCheckbox">
                    <span>åƒ…é¡¯ç¤ºæœå°‹çµæœ</span>
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="hideCompletedCheckbox">
                    <span>éš±è—å·²å®Œæˆåˆ†é…</span>
                </label>
            </div>
        </div>

        <div class="preset-section">
            <h3>å¿«é€Ÿåˆ†é…çµ„åˆ</h3>
            <div class="preset-controls">
                <select id="presetCharacter">
                    <option value="">é¸æ“‡è§’è‰²</option>
                </select>
                <button id="presetBtn1" class="btn btn-green">åŒæ—çµ„åˆ</button>
                <button id="presetBtn2" class="btn btn-blue">æˆ°å‹çµ„åˆ</button>
                <button id="presetBtn3" class="btn btn-indigo">æ“Šç¨®çµ„åˆ</button>
                <button id="presetBtn4" class="btn btn-teal">é€Ÿå¿…é›™å‰Š</button>
                <button id="resetPresetCharacter" class="btn btn-red">ğŸ”„ é‡ç½®</button>
            </div>
        </div>

        <div class="table-scroll-container">
            <table id="fruitTable">
                <thead>
                    <tr>
                        <th>è§’è‰²</th>
                        <th>æœå¯¦ 1</th>
                        <th>æœå¯¦ 2</th>
                        <th>æœå¯¦ 3</th>
                        <th>æœå¯¦ 4</th>
                    </tr>
                </thead>
                <tbody id="fruitTableBody"></tbody>
            </table>
        </div>
    </section>

    <div class="toolbox-container">
        <div class="toolbox-header">
            ğŸ§° å·¥å…·ç®±
        </div>
        <div class="toolbox-list">
            <a href="https://emily4027.github.io/monster-strike-toolbox/" class="toolbox-link">
                ğŸ  å·¥å…·ç®±é¦–é 
            </a>
            <a href="https://emily4027.github.io/monster-strike-gacha/" class="toolbox-link">
                ğŸ° æŠ½å¡æ¨¡æ“¬
            </a>
            <div class="toolbox-link active">
                ğŸ æœå¯¦åˆ†é…
            </div>
        </div>
    </div>

    <div id="characterModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>è§’è‰²æ¸…å–®</h3>
                <span class="close-modal">&times;</span>
            </div>
            <input type="text" id="modalCharacterSearch" placeholder="ğŸ” æœå°‹è¦åˆªé™¤çš„è§’è‰²..." class="full-width-input">
            <ul id="characterList"></ul>
        </div>
    </div>

    <div id="deleteFruitModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>åˆªé™¤æœå¯¦</h3>
                <span class="close-modal">&times;</span>
            </div>
            <p>é¸æ“‡è¦åˆªé™¤çš„æœå¯¦ï¼š</p>
            <select id="deleteFruitSelect" class="full-width-input">
                <option value="">è«‹é¸æ“‡æœå¯¦</option>
            </select>
            <div class="modal-footer">
                <button class="close-btn-action btn-gray">å–æ¶ˆ</button>
                <button id="confirmDeleteFruit" class="btn btn-red">ç¢ºèªåˆªé™¤</button>
            </div>
        </div>
    </div>

    <div id="fruitTransferModal" class="modal">
        <div class="modal-content small-modal">
            <div class="modal-header">
                <h3>æœå¯¦è½‰ç§»</h3>
                <span class="close-modal transfer-close">&times;</span>
            </div>
            <p id="transferSourceMessage" style="font-weight: bold;"></p>
            
            <div id="storageSourceSelector" style="margin-bottom: 15px; display: none;">
                 <p style="margin-top: 15px; font-weight: bold;">é¸æ“‡ç§»å‡ºæœå¯¦æ¬„ä½:</p>
                 <select id="storageSourceSlotSelect" class="full-width-input"></select>
            </div>
            
            <hr style="margin: 15px 0;">

            <p style="margin-top: 15px; font-weight: bold;">é¸æ“‡è½‰ç§»ç›®æ¨™ï¼š</p>
            
            <select id="transferDestinationType" class="full-width-input" style="margin-bottom: 10px;">
                <option value="">-- è«‹é¸æ“‡ç›®æ¨™é¡å‹ --</option>
                <option value="main">ä¸»åŠ›è§’è‰² (å¡«è£œç©ºç¼º)</option>
                <option value="bank">è‹±é›„ BANK (ç©ºé–’é³¥ç± )</option>
                <option value="storage">å€‰åº«è§’è‰² (ç©ºé–’æœå¯¦æ¬„ä½)</option>
            </select>
            
            <div id="transferTargetContainer">
                <p style="margin-top: 15px;">ç›®æ¨™å®¹å™¨:</p>
                <select id="transferTargetSelect" class="full-width-input"></select>
                
                <p style="margin-top: 15px;">ç›®æ¨™æ¬„ä½/ä½ç½®:</p>
                <select id="transferSlotSelect" class="full-width-input"></select>
            </div>

            
            <div class="modal-footer">
                <button class="transfer-close btn btn-gray">å–æ¶ˆ</button>
                <button id="confirmTransferBtn" class="btn btn-green">ç¢ºèªè½‰ç§»</button>
            </div>
        </div>
    </div>

    <div id="alertModal" class="modal">
        <div class="modal-content small-modal">
            <h3 id="alertTitle">æç¤º</h3>
            <p id="alertMessage"></p>
            <div class="modal-footer">
                <button id="alertOkBtn" class="btn btn-blue">ç¢ºèª</button>
            </div>
        </div>
    </div>

    <div id="confirmModal" class="modal">
        <div class="modal-content small-modal">
            <h3 id="confirmTitle">è«‹ç¢ºèª</h3>
            <p id="confirmMessage"></p>
            <div class="modal-footer">
                <button id="confirmCancelBtn" class="btn btn-gray">å–æ¶ˆ</button>
                <button id="confirmOkBtn" class="btn btn-red">ç¢ºèª</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
        
        // âš ï¸ æ‚¨çš„ Firebase é…ç½®
        const firebaseConfig = {
            apiKey: "AIzaSyAjpfcNC4ZniqIxYzgYwp5Cs_8gbbmflVY",
            authDomain: "ms-toolbox-web.firebaseapp.com",
            projectId: "ms-toolbox-web",
            storageBucket: "ms-toolbox-web.firebasestorage.app",
            messagingSenderId: "777818785736",
            appId: "1:777818785736:web:880b878f4a510132dfe2fd",
            measurementId: "G-7KV0FSL1RG"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // å°‡ Firebase ç‰©ä»¶æ›è¼‰åˆ° window ä»¥ä¾¿ script.js ä½¿ç”¨
        window.firebaseApp = app;
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseModules = { doc, getDoc, setDoc };
    </script>

    <script src="script.js"></script>
</body>
</html>